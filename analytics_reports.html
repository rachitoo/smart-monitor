<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analytics Reports - SafeCrowd Management System</title>
    <link rel="stylesheet" href="../css/main.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fsafecrowd6649back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.8"></script>
</head>
<body class="bg-background min-h-screen">
    <!-- Navigation Header -->
    <nav class="bg-surface border-b border-border shadow-subtle">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <svg class="h-8 w-8 text-primary" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <div class="ml-3">
                        <h1 class="text-xl font-semibold text-text-primary">SafeCrowd</h1>
                        <p class="text-xs text-text-secondary">Management System</p>
                    </div>
                </div>

                <!-- Navigation Links -->
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="live_monitoring_dashboard.html" class="text-text-secondary hover:text-text-primary hover:bg-secondary-100 px-3 py-2 rounded-md text-sm font-medium transition-smooth">
                            Live Monitoring
                        </a>
                        <a href="system_configuration.html" class="text-text-secondary hover:text-text-primary hover:bg-secondary-100 px-3 py-2 rounded-md text-sm font-medium transition-smooth">
                            Configuration
                        </a>
                        <a href="analytics_reports.html" class="bg-primary-100 text-primary px-3 py-2 rounded-md text-sm font-medium">
                            Analytics
                        </a>
                        <a href="alert_management.html" class="text-text-secondary hover:text-text-primary hover:bg-secondary-100 px-3 py-2 rounded-md text-sm font-medium transition-smooth">
                            Alerts
                        </a>
                    </div>
                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-text-secondary hover:text-text-primary p-2 rounded-md">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile menu -->
        <div id="mobile-menu" class="md:hidden hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 bg-surface border-t border-border">
                <a href="live_monitoring_dashboard.html" class="text-text-secondary hover:text-text-primary hover:bg-secondary-100 block px-3 py-2 rounded-md text-base font-medium">
                    Live Monitoring
                </a>
                <a href="system_configuration.html" class="text-text-secondary hover:text-text-primary hover:bg-secondary-100 block px-3 py-2 rounded-md text-base font-medium">
                    Configuration
                </a>
                <a href="analytics_reports.html" class="bg-primary-100 text-primary block px-3 py-2 rounded-md text-base font-medium">
                    Analytics
                </a>
                <a href="alert_management.html" class="text-text-secondary hover:text-text-primary hover:bg-secondary-100 block px-3 py-2 rounded-md text-base font-medium">
                    Alerts
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- Page Header -->
        <div class="mb-6">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h1 class="text-2xl font-semibold text-text-primary">Analytics Reports</h1>
                    <p class="text-text-secondary mt-1">Comprehensive crowd monitoring insights and historical data analysis</p>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="share-dashboard-btn" class="btn btn-secondary">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"/>
                        </svg>
                        Share Dashboard
                    </button>
                    <button id="generate-report-btn" class="btn btn-primary">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                        Generate Report
                    </button>
                </div>
            </div>
        </div>

        <!-- Filter Controls -->
        <div class="card p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Date Range Selector -->
                <div>
                    <label class="block text-sm font-medium text-text-secondary mb-2">Date Range</label>
                    <select id="date-range-selector" class="input">
                        <option value="today">Today</option>
                        <option value="yesterday">Yesterday</option>
                        <option value="last7days" selected>Last 7 Days</option>
                        <option value="last30days">Last 30 Days</option>
                        <option value="last90days">Last 90 Days</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>

                <!-- Location Dropdown -->
                <div>
                    <label class="block text-sm font-medium text-text-secondary mb-2">Location</label>
                    <select id="location-selector" class="input">
                        <option value="all" selected>All Locations</option>
                        <option value="main-entrance">Main Entrance</option>
                        <option value="lobby">Lobby Area</option>
                        <option value="conference-hall">Conference Hall</option>
                        <option value="emergency-exits">Emergency Exits</option>
                        <option value="parking-area">Parking Area</option>
                    </select>
                </div>

                <!-- Report Type Options -->
                <div>
                    <label class="block text-sm font-medium text-text-secondary mb-2">Report Type</label>
                    <select id="report-type-selector" class="input">
                        <option value="occupancy" selected>Occupancy Analysis</option>
                        <option value="safety">Safety Incidents</option>
                        <option value="capacity">Capacity Utilization</option>
                        <option value="trends">Trend Analysis</option>
                        <option value="performance">System Performance</option>
                    </select>
                </div>

                <!-- Time View Toggle -->
                <div>
                    <label class="block text-sm font-medium text-text-secondary mb-2">Time View</label>
                    <div class="flex rounded-md border border-border overflow-hidden">
                        <button id="hourly-view" class="flex-1 px-3 py-2 text-xs font-medium bg-primary text-white transition-smooth">Hourly</button>
                        <button id="daily-view" class="flex-1 px-3 py-2 text-xs font-medium bg-secondary-100 text-text-secondary hover:bg-secondary-200 transition-smooth">Daily</button>
                        <button id="weekly-view" class="flex-1 px-3 py-2 text-xs font-medium bg-secondary-100 text-text-secondary hover:bg-secondary-200 transition-smooth">Weekly</button>
                        <button id="monthly-view" class="flex-1 px-3 py-2 text-xs font-medium bg-secondary-100 text-text-secondary hover:bg-secondary-200 transition-smooth">Monthly</button>
                    </div>
                </div>
            </div>

            <!-- Custom Date Range (Hidden by default) -->
            <div id="custom-date-range" class="hidden mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-text-secondary mb-2">Start Date</label>
                    <input type="date" id="start-date" class="input" value="2025-09-18" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-text-secondary mb-2">End Date</label>
                    <input type="date" id="end-date" class="input" value="2025-09-25" />
                </div>
            </div>

            <!-- Loading Indicator -->
            <div id="loading-indicator" class="hidden mt-4 flex items-center justify-center">
                <svg class="animate-spin h-5 w-5 text-primary mr-2" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"/>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
                </svg>
                <span class="text-text-secondary">Updating visualizations...</span>
            </div>
        </div>

        <!-- Summary Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            <!-- Average Occupancy -->
            <div class="card p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-text-secondary">Average Occupancy</p>
                        <p class="text-2xl font-bold text-text-primary font-mono">68.5%</p>
                        <p class="text-xs text-success mt-1">
                            <svg class="w-3 h-3 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                            </svg>
                            +5.2% from last period
                        </p>
                    </div>
                    <div class="p-3 bg-primary-100 rounded-lg">
                        <svg class="w-6 h-6 text-primary" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Maximum Capacity -->
            <div class="card p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-text-secondary">Maximum Capacity</p>
                        <p class="text-2xl font-bold text-text-primary font-mono">94.2%</p>
                        <p class="text-xs text-warning mt-1">
                            <svg class="w-3 h-3 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M14.707 10.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 12.586V5a1 1 0 012 0v7.586l2.293-2.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            Peak reached yesterday
                        </p>
                    </div>
                    <div class="p-3 bg-warning-100 rounded-lg">
                        <svg class="w-6 h-6 text-warning" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Safety Score -->
            <div class="card p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-text-secondary">Safety Score</p>
                        <p class="text-2xl font-bold text-text-primary font-mono">8.7/10</p>
                        <p class="text-xs text-success mt-1">
                            <svg class="w-3 h-3 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                            </svg>
                            Excellent rating
                        </p>
                    </div>
                    <div class="p-3 bg-success-100 rounded-lg">
                        <svg class="w-6 h-6 text-success" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                </div>
            </div>

            <!-- Total Incidents -->
            <div class="card p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-text-secondary">Total Incidents</p>
                        <p class="text-2xl font-bold text-text-primary font-mono">3</p>
                        <p class="text-xs text-success mt-1">
                            <svg class="w-3 h-3 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M14.707 10.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 12.586V5a1 1 0 012 0v7.586l2.293-2.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                            </svg>
                            -2 from last week
                        </p>
                    </div>
                    <div class="p-3 bg-error-100 rounded-lg">
                        <svg class="w-6 h-6 text-error" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Analytics Dashboard -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Crowd Density Trends Chart -->
            <div class="card p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-text-primary">Crowd Density Trends</h3>
                    <button id="density-drill-down" class="text-sm text-primary hover:text-primary-700 font-medium">
                        Drill Down
                        <svg class="w-4 h-4 inline ml-1" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>
                <div class="h-80">
                    <canvas id="density-chart"></canvas>
                </div>
            </div>

            <!-- Peak Occupancy Periods -->
            <div class="card p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-text-primary">Peak Occupancy Periods</h3>
                    <button id="occupancy-drill-down" class="text-sm text-primary hover:text-primary-700 font-medium">
                        Drill Down
                        <svg class="w-4 h-4 inline ml-1" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </div>
                <div class="h-80">
                    <canvas id="occupancy-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Safety Incident Correlations -->
        <div class="card p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-text-primary">Safety Incident Correlations</h3>
                <button id="safety-drill-down" class="text-sm text-primary hover:text-primary-700 font-medium">
                    Drill Down
                    <svg class="w-4 h-4 inline ml-1" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                    </svg>
                </button>
            </div>
            <div class="h-96">
                <canvas id="safety-chart"></canvas>
            </div>
        </div>

        <!-- Data Tables Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <!-- Detailed Incident Logs -->
            <div class="card p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-text-primary">Incident Logs</h3>
                    <div class="flex items-center space-x-2">
                        <input type="text" id="incident-search" placeholder="Search incidents..." class="input text-sm w-48" />
                        <button id="export-incidents" class="btn btn-secondary text-sm">
                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                            Export
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th class="cursor-pointer hover:bg-secondary-200" onclick="sortTable('incident-table', 0)">
                                    Date/Time
                                    <svg class="w-3 h-3 inline ml-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M5 12l5-5 5 5H5z"/>
                                    </svg>
                                </th>
                                <th class="cursor-pointer hover:bg-secondary-200" onclick="sortTable('incident-table', 1)">
                                    Type
                                    <svg class="w-3 h-3 inline ml-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M5 12l5-5 5 5H5z"/>
                                    </svg>
                                </th>
                                <th class="cursor-pointer hover:bg-secondary-200" onclick="sortTable('incident-table', 2)">
                                    Severity
                                    <svg class="w-3 h-3 inline ml-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M5 12l5-5 5 5H5z"/>
                                    </svg>
                                </th>
                                <th>Location</th>
                            </tr>
                        </thead>
                        <tbody id="incident-table">
                            <tr>
                                <td>09/25/2025 14:32</td>
                                <td>Overcrowding</td>
                                <td><span class="status-pill status-pill-warning">Medium</span></td>
                                <td>Main Entrance</td>
                            </tr>
                            <tr>
                                <td>09/24/2025 16:45</td>
                                <td>Exit Blockage</td>
                                <td><span class="status-pill status-pill-error">High</span></td>
                                <td>Emergency Exit A</td>
                            </tr>
                            <tr>
                                <td>09/23/2025 11:20</td>
                                <td>Capacity Alert</td>
                                <td><span class="status-pill status-pill-success">Low</span></td>
                                <td>Conference Hall</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="flex items-center justify-between mt-4">
                    <p class="text-sm text-text-secondary">Showing 3 of 15 incidents</p>
                    <div class="flex items-center space-x-2">
                        <button class="btn btn-secondary text-sm" disabled>Previous</button>
                        <span class="px-3 py-1 bg-primary text-white rounded text-sm">1</span>
                        <span class="px-3 py-1 text-text-secondary text-sm">2</span>
                        <span class="px-3 py-1 text-text-secondary text-sm">3</span>
                        <button class="btn btn-secondary text-sm">Next</button>
                    </div>
                </div>
            </div>

            <!-- Occupancy Records -->
            <div class="card p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-text-primary">Occupancy Records</h3>
                    <div class="flex items-center space-x-2">
                        <input type="text" id="occupancy-search" placeholder="Search records..." class="input text-sm w-48" />
                        <button id="export-occupancy" class="btn btn-secondary text-sm">
                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                            Export
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th class="cursor-pointer hover:bg-secondary-200" onclick="sortTable('occupancy-table', 0)">
                                    Time
                                    <svg class="w-3 h-3 inline ml-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M5 12l5-5 5 5H5z"/>
                                    </svg>
                                </th>
                                <th class="cursor-pointer hover:bg-secondary-200" onclick="sortTable('occupancy-table', 1)">
                                    Count
                                    <svg class="w-3 h-3 inline ml-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M5 12l5-5 5 5H5z"/>
                                    </svg>
                                </th>
                                <th class="cursor-pointer hover:bg-secondary-200" onclick="sortTable('occupancy-table', 2)">
                                    Capacity %
                                    <svg class="w-3 h-3 inline ml-1" fill="currentColor" viewBox="0 0 20 20">
                                        <path d="M5 12l5-5 5 5H5z"/>
                                    </svg>
                                </th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="occupancy-table">
                            <tr>
                                <td>17:45</td>
                                <td>142</td>
                                <td>71.0%</td>
                                <td><span class="status-pill status-pill-success">Normal</span></td>
                            </tr>
                            <tr>
                                <td>17:30</td>
                                <td>189</td>
                                <td>94.5%</td>
                                <td><span class="status-pill status-pill-warning">High</span></td>
                            </tr>
                            <tr>
                                <td>17:15</td>
                                <td>156</td>
                                <td>78.0%</td>
                                <td><span class="status-pill status-pill-success">Normal</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="flex items-center justify-between mt-4">
                    <p class="text-sm text-text-secondary">Showing 3 of 48 records</p>
                    <div class="flex items-center space-x-2">
                        <button class="btn btn-secondary text-sm" disabled>Previous</button>
                        <span class="px-3 py-1 bg-primary text-white rounded text-sm">1</span>
                        <span class="px-3 py-1 text-text-secondary text-sm">2</span>
                        <span class="px-3 py-1 text-text-secondary text-sm">3</span>
                        <button class="btn btn-secondary text-sm">Next</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Performance Metrics -->
        <div class="card p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-text-primary">System Performance Metrics</h3>
                <div class="flex items-center space-x-2">
                    <input type="text" id="performance-search" placeholder="Search metrics..." class="input text-sm w-48" />
                    <button id="export-performance" class="btn btn-secondary text-sm">
                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                        Export
                    </button>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th class="cursor-pointer hover:bg-secondary-200" onclick="sortTable('performance-table', 0)">
                                Metric
                                <svg class="w-3 h-3 inline ml-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M5 12l5-5 5 5H5z"/>
                                </svg>
                            </th>
                            <th class="cursor-pointer hover:bg-secondary-200" onclick="sortTable('performance-table', 1)">
                                Current Value
                                <svg class="w-3 h-3 inline ml-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M5 12l5-5 5 5H5z"/>
                                </svg>
                            </th>
                            <th class="cursor-pointer hover:bg-secondary-200" onclick="sortTable('performance-table', 2)">
                                Target
                                <svg class="w-3 h-3 inline ml-1" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M5 12l5-5 5 5H5z"/>
                                </svg>
                            </th>
                            <th>Status</th>
                            <th>Last Updated</th>
                        </tr>
                    </thead>
                    <tbody id="performance-table">
                        <tr>
                            <td>Detection Accuracy</td>
                            <td>97.8%</td>
                            <td>95.0%</td>
                            <td><span class="status-pill status-pill-success">Excellent</span></td>
                            <td>17:45:24</td>
                        </tr>
                        <tr>
                            <td>Processing Speed</td>
                            <td>1.2s</td>
                            <td>1.5s</td>
                            <td><span class="status-pill status-pill-success">Good</span></td>
                            <td>17:45:20</td>
                        </tr>
                        <tr>
                            <td>System Uptime</td>
                            <td>99.9%</td>
                            <td>99.5%</td>
                            <td><span class="status-pill status-pill-success">Excellent</span></td>
                            <td>17:45:15</td>
                        </tr>
                        <tr>
                            <td>Camera Connectivity</td>
                            <td>98.5%</td>
                            <td>98.0%</td>
                            <td><span class="status-pill status-pill-success">Good</span></td>
                            <td>17:45:10</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Export Controls -->
        <div class="card p-6">
            <h3 class="text-lg font-semibold text-text-primary mb-4">Export & Scheduling Options</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- PDF Report Generation -->
                <div class="space-y-4">
                    <h4 class="font-medium text-text-primary">PDF Report Generation</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm text-text-secondary mb-1">Report Format</label>
                            <select class="input text-sm">
                                <option>Executive Summary</option>
                                <option>Detailed Analysis</option>
                                <option>Technical Report</option>
                                <option>Custom Format</option>
                            </select>
                        </div>
                        <button class="btn btn-primary w-full">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M6 2a2 2 0 00-2 2v12a2 2 0 002 2h8a2 2 0 002-2V7.414A2 2 0 0015.414 6L12 2.586A2 2 0 0010.586 2H6zm5 6a1 1 0 10-2 0v3.586l-1.293-1.293a1 1 0 10-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 11.586V8z" clip-rule="evenodd"/>
                            </svg>
                            Generate PDF
                        </button>
                    </div>
                </div>

                <!-- CSV Data Download -->
                <div class="space-y-4">
                    <h4 class="font-medium text-text-primary">CSV Data Download</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm text-text-secondary mb-1">Data Selection</label>
                            <select class="input text-sm">
                                <option>All Data</option>
                                <option>Occupancy Records</option>
                                <option>Incident Logs</option>
                                <option>Performance Metrics</option>
                            </select>
                        </div>
                        <button class="btn btn-secondary w-full">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                            </svg>
                            Download CSV
                        </button>
                    </div>
                </div>

                <!-- Scheduled Reports -->
                <div class="space-y-4">
                    <h4 class="font-medium text-text-primary">Scheduled Reports</h4>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm text-text-secondary mb-1">Delivery Frequency</label>
                            <select class="input text-sm">
                                <option>Daily</option>
                                <option>Weekly</option>
                                <option>Monthly</option>
                                <option>Custom Schedule</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-text-secondary mb-1">Email Recipients</label>
                            <input type="email" placeholder="admin@company.com" class="input text-sm" />
                        </div>
                        <button class="btn btn-primary w-full">
                            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"/>
                                <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"/>
                            </svg>
                            Schedule Reports
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global variables
        let densityChart, occupancyChart, safetyChart;
        let currentTimeView = 'hourly';
        let currentDateRange = 'last7days';
        let currentLocation = 'all';
        let currentReportType = 'occupancy';

        // DOM elements
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const loadingIndicator = document.getElementById('loading-indicator');
        const customDateRange = document.getElementById('custom-date-range');

        // Filter elements
        const dateRangeSelector = document.getElementById('date-range-selector');
        const locationSelector = document.getElementById('location-selector');
        const reportTypeSelector = document.getElementById('report-type-selector');

        // Time view buttons
        const hourlyView = document.getElementById('hourly-view');
        const dailyView = document.getElementById('daily-view');
        const weeklyView = document.getElementById('weekly-view');
        const monthlyView = document.getElementById('monthly-view');

        // Mobile menu toggle
        mobileMenuButton.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // Initialize charts
        function initCharts() {
            // Density Chart
            const densityCtx = document.getElementById('density-chart').getContext('2d');
            densityChart = new Chart(densityCtx, {
                type: 'line',
                data: {
                    labels: ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00'],
                    datasets: [{
                        label: 'Crowd Density',
                        data: [25, 45, 68, 82, 94, 76, 58, 72, 65],
                        borderColor: '#2563EB',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });

            // Occupancy Chart
            const occupancyCtx = document.getElementById('occupancy-chart').getContext('2d');
            occupancyChart = new Chart(occupancyCtx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Peak Occupancy',
                        data: [85, 92, 78, 96, 89, 67, 45],
                        backgroundColor: '#0EA5E9',
                        borderColor: '#0284C7',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });

            // Safety Chart
            const safetyCtx = document.getElementById('safety-chart').getContext('2d');
            safetyChart = new Chart(safetyCtx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Safety Incidents vs Occupancy',
                        data: [
                            {x: 45, y: 0},
                            {x: 68, y: 1},
                            {x: 82, y: 2},
                            {x: 94, y: 4},
                            {x: 76, y: 1},
                            {x: 58, y: 0},
                            {x: 72, y: 1}
                        ],
                        backgroundColor: '#DC2626',
                        borderColor: '#EF4444',
                        borderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Occupancy Level (%)'
                            },
                            min: 0,
                            max: 100
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Number of Incidents'
                            },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Show loading indicator
        function showLoading() {
            loadingIndicator.classList.remove('hidden');
        }

        // Hide loading indicator
        function hideLoading() {
            setTimeout(() => {
                loadingIndicator.classList.add('hidden');
            }, 1000);
        }

        // Update time view buttons
        function updateTimeViewButtons(activeView) {
            const buttons = [hourlyView, dailyView, weeklyView, monthlyView];
            const views = ['hourly', 'daily', 'weekly', 'monthly'];
            
            buttons.forEach((button, index) => {
                if (views[index] === activeView) {
                    button.className = 'flex-1 px-3 py-2 text-xs font-medium bg-primary text-white transition-smooth';
                } else {
                    button.className = 'flex-1 px-3 py-2 text-xs font-medium bg-secondary-100 text-text-secondary hover:bg-secondary-200 transition-smooth';
                }
            });
        }

        // Update charts based on filters
        function updateCharts() {
            showLoading();
            
            // Simulate data update
            setTimeout(() => {
                // Update chart data based on current filters
                const mockData = generateMockData();
                
                densityChart.data.labels = mockData.labels;
                densityChart.data.datasets[0].data = mockData.densityData;
                densityChart.update('active');
                
                occupancyChart.data.labels = mockData.labels;
                occupancyChart.data.datasets[0].data = mockData.occupancyData;
                occupancyChart.update('active');
                
                safetyChart.data.datasets[0].data = mockData.safetyData;
                safetyChart.update('active');
                
                hideLoading();
            }, 1000);
        }

        // Generate mock data based on current filters
        function generateMockData() {
            let labels, densityData, occupancyData, safetyData;
            
            switch(currentTimeView) {
                case 'hourly':
                    labels = ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00'];
                    densityData = [25, 45, 68, 82, 94, 76, 58, 72, 65];
                    occupancyData = [30, 50, 72, 86, 98, 80, 62, 76, 69];
                    break;
                case 'daily':
                    labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                    densityData = [65, 72, 58, 84, 79, 45, 32];
                    occupancyData = [70, 76, 62, 88, 83, 49, 36];
                    break;
                case 'weekly':
                    labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                    densityData = [68, 74, 62, 71];
                    occupancyData = [72, 78, 66, 75];
                    break;
                case 'monthly':
                    labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
                    densityData = [58, 64, 71, 68, 75, 69];
                    occupancyData = [62, 68, 75, 72, 79, 73];
                    break;
            }
            
            safetyData = densityData.map((density, index) => ({
                x: density,
                y: Math.floor(density / 25)
            }));
            
            return { labels, densityData, occupancyData, safetyData };
        }

        // Table sorting function
        function sortTable(tableId, columnIndex) {
            const table = document.getElementById(tableId);
            const rows = Array.from(table.rows);
            const isNumeric = !isNaN(parseFloat(rows[0].cells[columnIndex].textContent));
            
            rows.sort((a, b) => {
                const aVal = a.cells[columnIndex].textContent.trim();
                const bVal = b.cells[columnIndex].textContent.trim();
                
                if (isNumeric) {
                    return parseFloat(aVal) - parseFloat(bVal);
                } else {
                    return aVal.localeCompare(bVal);
                }
            });
            
            rows.forEach(row => table.appendChild(row));
        }

        // Export functions
        function exportToPDF() {
            // Simulate PDF generation
            const link = document.createElement('a');
            link.href = 'data:application/pdf;base64,JVBERi0xLjQKJdPr6eEKMSAwIG9iago8PAovVGl0bGUgKFNhZmVDcm93ZCBBbmFseXRpY3MgUmVwb3J0KQovQ3JlYXRvciAoU2FmZUNyb3dkIE1hbmFnZW1lbnQgU3lzdGVtKQovUHJvZHVjZXIgKFNhZmVDcm93ZCBNYW5hZ2VtZW50IFN5c3RlbSkKL0NyZWF0aW9uRGF0ZSAoRDoyMDI1MDkyNTE3NDcwMCkKPj4KZW5kb2JqCjIgMCBvYmoKPDwKL1R5cGUgL0NhdGFsb2cKL1BhZ2VzIDMgMCBSCj4+CmVuZG9iagozIDAgb2JqCjw8Ci9UeXBlIC9QYWdlcwovS2lkcyBbNCAwIFJdCi9Db3VudCAxCj4+CmVuZG9iago0IDAgb2JqCjw8Ci9UeXBlIC9QYWdlCi9QYXJlbnQgMyAwIFIKL01lZGlhQm94IFswIDAgNjEyIDc5Ml0KPj4KZW5kb2JqCnhyZWYKMCA1CjAwMDAwMDAwMDAgNjU1MzUgZiAKMDAwMDAwMDAwOSAwMDAwMCBuIAowMDAwMDAwMTc0IDAwMDAwIG4gCjAwMDAwMDAyMjEgMDAwMDAgbiAKMDAwMDAwMDI3OCAwMDAwMCBuIAp0cmFpbGVyCjw8Ci9TaXplIDUKL1Jvb3QgMiAwIFIKPj4Kc3RhcnR4cmVmCjM3OAolJUVPRg==';
            link.download = `safecrowd-analytics-report-${new Date().toISOString().slice(0, 10)}.pdf`;
            link.click();
        }

        function exportToCSV(dataType) {
            let csvContent = '';
            let filename = '';
            
            switch(dataType) {
                case 'incidents':
                    csvContent = 'Date/Time,Type,Severity,Location\n09/25/2025 14:32,Overcrowding,Medium,Main Entrance\n09/24/2025 16:45,Exit Blockage,High,Emergency Exit A\n09/23/2025 11:20,Capacity Alert,Low,Conference Hall';
                    filename = 'incident-logs';
                    break;
                case 'occupancy':
                    csvContent = 'Time,Count,Capacity %,Status\n17:45,142,71.0%,Normal\n17:30,189,94.5%,High\n17:15,156,78.0%,Normal';
                    filename = 'occupancy-records';
                    break;
                case 'performance':
                    csvContent = 'Metric,Current Value,Target,Status,Last Updated\nDetection Accuracy,97.8%,95.0%,Excellent,17:45:24\nProcessing Speed,1.2s,1.5s,Good,17:45:20\nSystem Uptime,99.9%,99.5%,Excellent,17:45:15';
                    filename = 'performance-metrics';
                    break;
            }
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${filename}-${new Date().toISOString().slice(0, 10)}.csv`;
            link.click();
            URL.revokeObjectURL(url);
        }

        // Event listeners
        dateRangeSelector.addEventListener('change', (e) => {
            currentDateRange = e.target.value;
            if (e.target.value === 'custom') {
                customDateRange.classList.remove('hidden');
            } else {
                customDateRange.classList.add('hidden');
            }
            updateCharts();
        });

        locationSelector.addEventListener('change', (e) => {
            currentLocation = e.target.value;
            updateCharts();
        });

        reportTypeSelector.addEventListener('change', (e) => {
            currentReportType = e.target.value;
            updateCharts();
        });

        // Time view buttons
        hourlyView.addEventListener('click', () => {
            currentTimeView = 'hourly';
            updateTimeViewButtons('hourly');
            updateCharts();
        });

        dailyView.addEventListener('click', () => {
            currentTimeView = 'daily';
            updateTimeViewButtons('daily');
            updateCharts();
        });

        weeklyView.addEventListener('click', () => {
            currentTimeView = 'weekly';
            updateTimeViewButtons('weekly');
            updateCharts();
        });

        monthlyView.addEventListener('click', () => {
            currentTimeView = 'monthly';
            updateTimeViewButtons('monthly');
            updateCharts();
        });

        // Export button event listeners
        document.getElementById('generate-report-btn').addEventListener('click', exportToPDF);
        document.getElementById('export-incidents').addEventListener('click', () => exportToCSV('incidents'));
        document.getElementById('export-occupancy').addEventListener('click', () => exportToCSV('occupancy'));
        document.getElementById('export-performance').addEventListener('click', () => exportToCSV('performance'));

        // Share dashboard
        document.getElementById('share-dashboard-btn').addEventListener('click', () => {
            if (navigator.share) {
                navigator.share({
                    title: 'SafeCrowd Analytics Dashboard',
                    text: 'Check out the latest crowd monitoring analytics',
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(window.location.href);
                alert('Dashboard link copied to clipboard!');
            }
        });

        // Search functionality
        document.getElementById('incident-search').addEventListener('input', (e) => {
            // Implement search functionality
            console.log('Searching incidents:', e.target.value);
        });

        document.getElementById('occupancy-search').addEventListener('input', (e) => {
            // Implement search functionality
            console.log('Searching occupancy:', e.target.value);
        });

        document.getElementById('performance-search').addEventListener('input', (e) => {
            // Implement search functionality
            console.log('Searching performance:', e.target.value);
        });

        // Initialize application
        document.addEventListener('DOMContentLoaded', () => {
            initCharts();
            updateTimeViewButtons('hourly');
        });
    </script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>
